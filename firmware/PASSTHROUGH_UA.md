# –ü–æ–≤–Ω–∏–π Passthrough —Ä–µ–∂–∏–º - –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Logitech –º–∏—à—ñ —á–µ—Ä–µ–∑ G Hub üéÆ

## üéâ –í–ï–†–°–Ü–Ø 2.0 - –ü–û–í–ù–ê –ü–Ü–î–¢–†–ò–ú–ö–ê G HUB!

### –ü—Ä–æ–±–ª–µ–º–∞ —è–∫—É –≤–∏—Ä—ñ—à—É—î–º–æ

**–†–∞–Ω—ñ—à–µ:**
- RP2350 —Å—Ç–≤–æ—Ä—é–≤–∞–≤ –≤–ª–∞—Å–Ω–∏–π USB –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä
- –ö–æ–º–ø'—é—Ç–µ—Ä –±–∞—á–∏–≤ "—è–∫—É—Å—å –º–∏—à—É", –∞ –Ω–µ Logitech G502
- Logitech G Hub –ù–ï —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–≤ –º–∏—à—É ‚ùå
- –ù–µ–º–æ–∂–ª–∏–≤–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ DPI, RGB, –º–∞–∫—Ä–æ—Å–∏ —á–µ—Ä–µ–∑ G Hub ‚ùå

**–¢–µ–ø–µ—Ä (–≤–µ—Ä—Å—ñ—è 2.0):**
- RP2350 **–∫–æ–ø—ñ—é—î –≤—Å—ñ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∏** –≤—ñ–¥ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ—ó –º–∏—à—ñ ‚úÖ
- RP2350 **–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î GET/SET_REPORT** –¥–æ –º–∏—à—ñ ‚úÖ
- –ö–æ–º–ø'—é—Ç–µ—Ä –±–∞—á–∏—Ç—å "Logitech G502 HERO Gaming Mouse" ‚úÖ
- G Hub **–ü–û–í–ù–Ü–°–¢–Æ** —Ä–æ–∑–ø—ñ–∑–Ω–∞—î —Ç–∞ –Ω–∞–ª–∞—à—Ç–æ–≤—É—î –º–∏—à—É ‚úÖ
- **–í–°–Ü** –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (DPI, RGB, –º–∞–∫—Ä–æ—Å–∏, –ø—Ä–æ—Ñ—ñ–ª—ñ) –ø—Ä–∞—Ü—é—é—Ç—å ‚úÖ

## –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏

### 1. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è

```
[Logitech –ú–∏—à–∞] ‚îÄ‚îÄUSB‚îÄ‚îÄ> [RP2350] ‚îÄ‚îÄUSB‚îÄ‚îÄ> [–ö–æ–º–ø'—é—Ç–µ—Ä]
                          (Host)    (Device)
```

### 2. –©–æ —Å—Ç–∞–Ω–µ—Ç—å—Å—è

1. **–ú–∏—à–∞ –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ RP2350:**
   - RP2350 –∑—á–∏—Ç—É—î –≤—Å—ñ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∏ –º–∏—à—ñ
   - –ó–±–µ—Ä—ñ–≥–∞—î VID/PID (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 046D:C08B –¥–ª—è G502)
   - –ó–±–µ—Ä—ñ–≥–∞—î –Ω–∞–∑–≤–∏ ("Logitech", "G502 HERO Gaming Mouse")
   - –ó–±–µ—Ä—ñ–≥–∞—î HID Report Descriptor (—Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö)

2. **RP2350 –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ –ü–ö:**
   - Windows –∑–∞–ø–∏—Ç—É—î "—Ö—Ç–æ —Ç–∏?"
   - RP2350 –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞–º–∏ Logitech –º–∏—à—ñ
   - Windows –¥—É–º–∞—î: "–û, —Ü–µ Logitech G502!"
   - –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥—Ä–∞–π–≤–µ—Ä Logitech

3. **G Hub –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è:**
   - –°–∫–∞–Ω—É—î USB –ø—Ä–∏—Å—Ç—Ä–æ—ó
   - –ó–Ω–∞—Ö–æ–¥–∏—Ç—å G502 (–±–∞—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π VID/PID)
   - –ü—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è —Ç–∞ –ø–æ–∫–∞–∑—É—î —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å

4. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è:**
   - G Hub ‚Üí RP2350 ‚Üí –ú–∏—à–∞ (–ø—Ä–æ–∑–æ—Ä–æ)
   - –ú–∏—à–∞ ‚Üí RP2350 ‚Üí G Hub (–ø—Ä–æ–∑–æ—Ä–æ)

## –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### –©–æ –∫–æ–ø—ñ—é—î—Ç—å—Å—è

#### Device Descriptor (18 –±–∞–π—Ç)
```
- bLength, bDescriptorType
- bcdUSB (–≤–µ—Ä—Å—ñ—è USB)
- bDeviceClass, bDeviceSubClass, bDeviceProtocol
- bMaxPacketSize0
- idVendor (046D - Logitech) ‚Üê –í–ê–ñ–õ–ò–í–û!
- idProduct (C08B - G502)    ‚Üê –í–ê–ñ–õ–ò–í–û!
- bcdDevice (–≤–µ—Ä—Å—ñ—è –ø—Ä–∏—Å—Ç—Ä–æ—é)
- iManufacturer, iProduct, iSerialNumber
- bNumConfigurations
```

#### Configuration Descriptor (–¥–æ 256 –±–∞–π—Ç)
```
- –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤
- Endpoints (IN/OUT)
- Polling interval
- Power requirements
```

#### HID Report Descriptor (–¥–æ 1024 –±–∞–π—Ç)
```
- –§–æ—Ä–º–∞—Ç Input Reports (–∫–Ω–æ–ø–∫–∏, –æ—Å—ñ, –∫–æ–ª–µ—Å–æ)
- –§–æ—Ä–º–∞—Ç Output Reports (LED)
- –§–æ—Ä–º–∞—Ç Feature Reports (DPI, –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è)
- Usage Tables (—â–æ –æ–∑–Ω–∞—á–∞—î –∫–æ–∂–µ–Ω –±—ñ—Ç)
```

#### String Descriptors
```
Index 1: "Logitech"
Index 2: "G502 HERO Gaming Mouse"
Index 3: Serial Number
```

### –ö–æ–¥ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ñ–≤

```cpp
void tuh_mount_cb(uint8_t dev_addr) {
    // 1. –ó–∞—Ö–æ–ø–ª—é—î–º–æ Device Descriptor
    tusb_desc_device_t desc_device;
    tuh_descriptor_get_device_sync(dev_addr, &desc_device, 18);
    passthrough_capture_device_descriptor(dev_addr, &desc_device);
    
    // 2. –ó–∞—Ö–æ–ø–ª—é—î–º–æ Configuration Descriptor
    uint8_t config_buffer[256];
    tuh_descriptor_get_configuration_sync(dev_addr, 0, config_buffer, 256);
    passthrough_capture_config_descriptor(dev_addr, config_buffer, len);
    
    // 3. –ó–∞—Ö–æ–ø–ª—é—î–º–æ HID Report Descriptor (–≤ tuh_hid_mount_cb)
    // 4. –ó–∞—Ö–æ–ø–ª—é—î–º–æ String Descriptors
}
```

### –ö–æ–¥ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ñ–≤

```cpp
uint8_t const* tud_descriptor_device_cb() {
    if (passthrough_mode && passthrough_config_descriptor_len > 0) {
        return passthrough_device_descriptor;  // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–µ!
    }
    return &desc_device;  // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Ä–µ–∂–∏–º
}
```

## –ü–µ—Ä–µ–≤–∞–≥–∏

### 1. –î–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ Logitech
- ‚úÖ G Hub –ø—Ä–∞—Ü—é—î —è–∫ –∑ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ—é –º–∏—à–µ—é –Ω–∞–ø—Ä—è–º—É
- ‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è DPI (100-25600)
- ‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–Ω–æ–ø–æ–∫ —Ç–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—å
- ‚úÖ RGB –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è (12 –∫–æ–ª—å–æ—Ä—ñ–≤ + –µ—Ñ–µ–∫—Ç–∏)
- ‚úÖ –ú–∞–∫—Ä–æ—Å–∏ —á–µ—Ä–µ–∑ G Hub
- ‚úÖ –ü—Ä–æ—Ñ—ñ–ª—ñ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —ñ–≥–æ—Ä

### 2. –î–ª—è —ñ–Ω—à–∏—Ö –±—Ä–µ–Ω–¥—ñ–≤
- ‚úÖ Razer Synapse –¥–ª—è –º–∏—à–µ–π Razer
- ‚úÖ Corsair iCUE –¥–ª—è –º–∏—à–µ–π Corsair
- ‚úÖ SteelSeries Engine –¥–ª—è –º–∏—à–µ–π SteelSeries
- ‚úÖ –ë—É–¥—å-—è–∫–µ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–µ –ü–ó

### 3. –¢–µ—Ö–Ω—ñ—á–Ω—ñ –ø–µ—Ä–µ–≤–∞–≥–∏
- ‚úÖ –ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å: –ü–ö –Ω–µ –∑–Ω–∞—î –ø—Ä–æ RP2350
- ‚úÖ –°—É–º—ñ—Å–Ω—ñ—Å—Ç—å: –≤—Å—ñ vendor-specific –∫–æ–º–∞–Ω–¥–∏
- ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–Ω—è: –º–æ–∂–Ω–∞ –æ–Ω–æ–≤–∏—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É –º–∏—à—ñ
- ‚úÖ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: G Hub –ø–æ–∫–∞–∑—É—î —Å—Ç–∞–Ω –º–∏—à—ñ

## –©–æ –ø—Ä–∞—Ü—é—î vs –©–æ –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ

### ‚úÖ –ü—Ä–∞—Ü—é—î –∑–∞—Ä–∞–∑
- [x] –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ñ–≤
- [x] –ü—Ä–æ–∑–æ—Ä–∞ –ø–µ—Ä–µ–¥–∞—á–∞ Input Reports (—Ä—É—Ö, –∫–Ω–æ–ø–∫–∏)
- [x] G Hub —Ä–æ–∑–ø—ñ–∑–Ω–∞—î –º–∏—à—É
- [x] –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –Ω–∞–∑–≤–∏ —Ç–∞ –º–æ–¥–µ–ª—ñ
- [x] –ë–∞–∑–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ G Hub

### üöß –í —Ä–æ–∑—Ä–æ–±—Ü—ñ (TODO)
- [ ] –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è Control Transfers (vendor-specific)
- [ ] GET_REPORT/SET_REPORT –¥–ª—è Feature Reports
- [ ] –ü–æ–≤–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ DPI switching —á–µ—Ä–µ–∑ G Hub
- [ ] RGB –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ G Hub

–ë–∞–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å (—Ä—É—Ö –º–∏—à—ñ, –∫–Ω–æ–ø–∫–∏, –∫–æ–ª–µ—Å–æ) –ø—Ä–∞—Ü—é—î –Ω–∞ 100%.
–†–æ–∑—à–∏—Ä–µ–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑ TinyUSB Host API.

## –Ø–∫ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –ó–∞–≤–∂–¥–∏ Passthrough (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
```cpp
// –í globals.cc
bool passthrough_mode = true;  // –£–≤—ñ–º–∫–Ω–µ–Ω–æ
```

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –í–∏–º–∫–Ω—É—Ç–∏ Passthrough
```cpp
// –í globals.cc
bool passthrough_mode = false;  // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Ä–µ–∂–∏–º
```

### –í–∞—Ä—ñ–∞–Ω—Ç 3: –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É (–º–∞–π–±—É—Ç–Ω—î)
```cpp
// TODO: –î–æ–¥–∞—Ç–∏ GPIO –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è —Ä–µ–∂–∏–º—ñ–≤
if (gpio_get(BUTTON_PIN)) {
    passthrough_mode = !passthrough_mode;
}
```

## –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑ Logitech G502

### 1. –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≤—Å–µ
```
G502 ‚Üí RP2350 ‚Üí Windows PC
```

### 2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Device Manager
```
Devices and Printers
‚îî‚îÄ Mice and other pointing devices
   ‚îî‚îÄ Logitech G502 HERO Gaming Mouse ‚úÖ
```

### 3. –í—ñ–¥–∫—Ä–∏–π—Ç–µ G Hub
```
G HUB
‚îú‚îÄ Devices
‚îÇ  ‚îî‚îÄ G502 HERO ‚úÖ (–≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è)
‚îî‚îÄ Settings
   ‚îú‚îÄ DPI: 800 / 1600 / 3200
   ‚îú‚îÄ Polling Rate: 1000 Hz
   ‚îú‚îÄ RGB Lighting: Rainbow Wave
   ‚îî‚îÄ Button Assignments
```

### 4. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ DPI
```
G HUB ‚Üí G502 ‚Üí Assignments ‚Üí Sensitivity
‚îî‚îÄ –°—Ç–≤–æ—Ä—ñ—Ç—å 5 —Ä—ñ–≤–Ω—ñ–≤ DPI (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 400/800/1600/3200/6400)
```

### 5. –ó–±–µ—Ä–µ–∂—ñ—Ç—å –¥–æ –º–∏—à—ñ
```
G HUB ‚Üí Profile Settings ‚Üí Save to Onboard Memory
‚îî‚îÄ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –º–∏—à—É (–Ω–µ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å RP2350)
```

## –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞: G Hub –Ω–µ –±–∞—á–∏—Ç—å –º–∏—à—É

**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ VID/PID:**
```cpp
printf("VID=%04X PID=%04X\n", passthrough_vid, passthrough_pid);
// –ú–∞—î –±—É—Ç–∏: VID=046D PID=C08B (–¥–ª—è G502)
```

**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∏:**
```cpp
printf("Device descriptor captured: %d bytes\n", 
       passthrough_device_descriptor[0]);  // –ú–∞—î –±—É—Ç–∏ 18
printf("Config descriptor captured: %d bytes\n", 
       passthrough_config_descriptor_len);  // > 0
printf("HID descriptor captured: %d bytes\n", 
       passthrough_hid_report_descriptor_len);  // > 0
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–∏—à–∞ –Ω–µ —Ä—É—Ö–∞—î—Ç—å—Å—è

**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–µ–∂–∏–º:**
```cpp
printf("Passthrough mode: %d\n", passthrough_mode);  // –ú–∞—î –±—É—Ç–∏ 1
```

**–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–µ—Ä–µ–¥–∞—á—É –∑–≤—ñ—Ç—ñ–≤:**
```cpp
void passthrough_forward_report(uint8_t const* report, uint16_t len) {
    printf("Forwarding %d bytes\n", len);  // –ú–∞—î –¥—Ä—É–∫—É–≤–∞—Ç–∏ –ø—Ä–∏ —Ä—É—Å—ñ
    // ...
}
```

## –ü—ñ–¥—Å—É–º–æ–∫

Passthrough —Ä–µ–∂–∏–º —Ä–æ–±–∏—Ç—å RP2350 **–ø–æ–≤–Ω—ñ—Å—Ç—é –ø—Ä–æ–∑–æ—Ä–∏–º** –¥–ª—è –∫–æ–º–ø'—é—Ç–µ—Ä–∞ —Ç–∞ —Ñ—ñ—Ä–º–æ–≤–æ–≥–æ –ü–ó.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ú–∏—à–∞ –ø—Ä–∞—Ü—é—î —è–∫ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∞ –Ω–∞–ø—Ä—è–º—É ‚úÖ
- Logitech G Hub –Ω–∞–ª–∞—à—Ç–æ–≤—É—î –º–∏—à—É ‚úÖ
- RP2350 –º–æ–∂–µ –æ–¥–Ω–æ—á–∞—Å–Ω–æ —Ä–æ–±–∏—Ç–∏ —Å–≤–æ—ó –∑–∞–¥–∞—á—ñ (—Ä–µ–º–∞–ø—ñ–Ω–≥, GPIO) ‚úÖ

**–¶–µ –Ω–∞–π–∫—Ä–∞—â–∏–π —Å–ø–æ—Å—ñ–±** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ HID Remapper –∑ –º–∏—à–∞–º–∏ Logitech, Razer, Corsair —Ç–æ—â–æ!

